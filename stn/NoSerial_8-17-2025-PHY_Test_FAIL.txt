
-------------     Start     --------------------
--------------------------------
PHY BIST
write BMCR: MII loopback, 100MBps, Duplex Mode
OpbWrite 32'h00060000 32'h00806100
OpbWrite 32'h00060000 32'h00000000
OpbRead 32'h00060000 32'h01006100
write BICSR1: IPG_LENGTH = 7D
OpbWrite 32'h00060000 32'h00DC007D
OpbWrite 32'h00060000 32'h005C0000
OpbRead 32'h00060000 32'h015C0075
write BICSR2: PKG_LENGTH = 5EE
OpbWrite 32'h00060000 32'h00F005EE
OpbWrite 32'h00060000 32'h00700000
OpbRead 32'h00060000 32'h017005EE
write BICSR: BIST start
OpbWrite 32'h00060000 32'h00D83044
OpbWrite 32'h00060000 32'h00580000
OpbRead 32'h00060000 32'h01583B44
read BICSR: BIST status
OpbWrite 32'h00060000 32'h00580000
OpbRead 32'h00060000 32'h01583B44
read BICSR1: BIST Error Count
OpbWrite 32'h00060000 32'h006C0000
OpbRead 32'h00060000 32'h016C007D
write BICSR: BIST stop
OpbWrite 32'h00060000 32'h00D80000
OpbWrite 32'h00060000 32'h00580000
OpbRead 32'h00060000 32'h01580500
read BICSR: BIST status
OpbWrite 32'h00060000 32'h00580000
OpbRead 32'h00060000 32'h01580100
read BICSR1: BIST Error Count
OpbWrite 32'h00060000 32'h006C0000
OpbRead 32'h00060000 32'h016C007D
read PHYSTS : PHY Status
OpbWrite 32'h00060000 32'h00400000
OpbRead 32'h00060000 32'h0140491C
--------------------------------
PHY dummy Registers
read BMCR @ 0x00
OpbWrite 32'h00060000 32'h00000000
OpbRead 32'h00060000 32'h01006100
read BMSR @ 0x01
OpbWrite 32'h00060000 32'h00040000
OpbRead 32'h00060000 32'h01047849
read PHYIDR1 @ 0x02
OpbWrite 32'h00060000 32'h00080000
OpbRead 32'h00060000 32'h01082000
read PHYIDR2 @ 0x03
OpbWrite 32'h00060000 32'h000C0000
OpbRead 32'h00060000 32'h010CA140
read ANAR @ 0x04
OpbWrite 32'h00060000 32'h00100000
OpbRead 32'h00060000 32'h011001E1
read ALNPAR @ 0x05
OpbWrite 32'h00060000 32'h00140000
OpbRead 32'h00060000 32'h01140000
read ANER @ 0x06
OpbWrite 32'h00060000 32'h00180000
OpbRead 32'h00060000 32'h01180006
read ANNPTR @ 0x07
OpbWrite 32'h00060000 32'h001C0000
OpbRead 32'h00060000 32'h011C2001
read ANLNPTR @ 0x08
OpbWrite 32'h00060000 32'h00200000
OpbRead 32'h00060000 32'h01200000
read CR1 @ 0x09
OpbWrite 32'h00060000 32'h00240000
OpbRead 32'h00060000 32'h01240020
read CR2 @ 0x0A
OpbWrite 32'h00060000 32'h00280000
OpbRead 32'h00060000 32'h01280100
read CR3 @ 0x0B
OpbWrite 32'h00060000 32'h002C0000
OpbRead 32'h00060000 32'h012C0000
read Register_12 @ 0x0C
OpbWrite 32'h00060000 32'h00300000
OpbRead 32'h00060000 32'h01300000
read REGCR @ 0x0D
OpbWrite 32'h00060000 32'h00340000
OpbRead 32'h00060000 32'h01340000
read ADDAR @ 0x0E
OpbWrite 32'h00060000 32'h00380000
OpbRead 32'h00060000 32'h01380000
read FLDS @ 0x0F
OpbWrite 32'h00060000 32'h003C0000
OpbRead 32'h00060000 32'h013C0000
read PHYSTS @ 0x10
OpbWrite 32'h00060000 32'h00400000
OpbRead 32'h00060000 32'h0140480C
read PHYSCR @ 0x11
OpbWrite 32'h00060000 32'h00440000
OpbRead 32'h00060000 32'h01440108
read MISR1 @ 0x12
OpbWrite 32'h00060000 32'h00480000
OpbRead 32'h00060000 32'h0148E600
read MISR2 @ 0x13
OpbWrite 32'h00060000 32'h004C0000
OpbRead 32'h00060000 32'h014C2800
write PHY_CTRL_ADDR : reset phy
OpbWrite 32'h00060001 32'h00000002
write PHY_CTRL_ADDR : release reset
OpbWrite 32'h00060001 32'h00000000
OpbRead 32'h00060001 32'h00000000
--------------------------------
PHY Init
write BMCR : B15=1, reset
OpbWrite 32'h00060000 32'h0080B100
read BMCR : B15=0
OpbWrite 32'h00060000 32'h00000000
RMII configuration: RCSR(0x17) = 0x81
OpbWrite 32'h00060000 32'h00DC0081
Disable Wake on Lan(todo)
write BMCR : Enable Auto-Neo
OpbWrite 32'h00060000 32'h00803100
OpbWrite 32'h00060000 32'h00000000
OpbRead 32'h00060000 32'h01003100
write ANAR : ENABLE Duplex-Mode
OpbWrite 32'h00060000 32'h009001E1
OpbRead 32'h00060000 32'h01903100
read ANAR : ENABLE Duplex-Mode
OpbWrite 32'h00060000 32'h00100000
OpbRead 32'h00060000 32'h011001E1
read ANNPTR : Page Config
OpbWrite 32'h00060000 32'h001C0000
OpbRead 32'h00060000 32'h011C2001
read LEDCR  : LED Config
OpbWrite 32'h00060000 32'h00600000
OpbRead 32'h00060000 32'h01600400
write PHYCR  : Restart MDIX
OpbWrite 32'h00060000 32'h00E48000
write BMCR  : RESTART_AUTO_NEG
OpbWrite 32'h00060000 32'h00803300
Sleep(1)...
read PHYSTS : PHY Status
OpbWrite 32'h00060000 32'h00400000
OpbRead 32'h00060000 32'h01400002
--------------------------------
PHY_FunctionTest
write PHY_TX_WORD0_ADDR
OpbWrite 32'h00060010 32'h12345678
write PHY_TX_WORD1_ADDR
OpbWrite 32'h00060011 32'h9ABCDEF0
write PHY_TX_WORD2_ADDR
OpbWrite 32'h00060012 32'h11223344
write PHY_TX_WORD3_ADDR
OpbWrite 32'h00060013 32'h55667788
read PHY_STATUS_ADDR : PHY Package TEST Result before test runs
OpbRead 32'h00060002 32'h00000000
write PHY_CTRL_ADDR : PHY Package TEST is running...
OpbWrite 32'h00060001 32'h00000001
OpbWrite 32'h00060001 32'h00000000
OpbWrite 32'h00060001 32'h00000001
OpbWrite 32'h00060001 32'h00000000
OpbWrite 32'h00060001 32'h00000001
OpbWrite 32'h00060001 32'h00000000
OpbRead 32'h00060001 32'h00000000
read PHY_STATUS_ADDR : PHY Package TEST Result after test runs
OpbRead 32'h00060002 32'h00000000
read PHY_RX_WORD0_ADDR
OpbRead 32'h00060020 32'h00000000
read PHY_RX_WORD1_ADDR
OpbRead 32'h00060021 32'h00000000
read PHY_RX_WORD2_ADDR
OpbRead 32'h00060022 32'h00000000
read PHY_RX_WORD3_ADDR
OpbRead 32'h00060023 32'h00000000
read PHY_RX_WORD4_ADDR
OpbRead 32'h00060024 32'h00000000
read PHY_RX_WORD5_ADDR
OpbRead 32'h00060025 32'h00000000
read PHY_RX_WORD6_ADDR
OpbRead 32'h00060026 32'h00000000
read PHY_RX_WORD7_ADDR
OpbRead 32'h00060027 32'h00000000
read PHY_RX_WORD8_ADDR
OpbRead 32'h00060028 32'h00000000
read PHY_RX_WORD9_ADDR
OpbRead 32'h00060029 32'h00000000
read PHY_RX_WORD10_ADDR
OpbRead 32'h0006002A 32'h00000000
read PHY_RX_WORD11_ADDR
OpbRead 32'h0006002B 32'h00000000
PHY Test failed!
-------------  CleanUpTest  --------------------